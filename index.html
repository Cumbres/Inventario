<html><head><base href="https://docs.google.com/spreadsheets/d/104GGPflFlJrQWhsH3ig7cPo72AubWlO0/edit?usp=drivesdk&amp;ouid=114403781423643563131&amp;rtpof=true&amp;sd=true" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" /><style>
  body {
    font-family: 'Roboto', Arial, sans-serif;
    line-height: 1.6;
    color: #333;
    margin: 0;
    padding: 0;
    background-color: #f0f2f5;
  }
  header {
    background-color: #1a73e8;
    color: white;
    padding: 20px 0;
    text-align: center;
  }
  header h1 {
    margin: 0;
    font-size: 2em;
    color: white;
  }
  header h2 {
    margin: 0;
    font-size: 1.4em;
    color: white;
    padding-top: 10px;
  }
  .header-divider {
    width: 50%;
    height: 1px;
    background-color: rgba(255, 255, 255, 0.5);
    margin: 10px auto;
  }
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px 20px 0;
  }
  h2, h3 {
    color: #1a73e8;
    margin: 0;
  }
  h2 { font-size: 1.6em; margin-bottom: 10px; }
  h3 { font-size: 1.3em; margin: 0 0 20px; text-align: center; }
  nav ul {
    list-style-type: none;
    padding: 0;
    display: flex;
    justify-content: center;
  }
  nav ul li {
    margin: 0 15px;
  }
  nav ul li a {
    color: white;
    text-decoration: none;
    font-weight: bold;
  }
  button, .filter-buttons button, #apply-filter {
    background-color: #1a73e8;
    color: white;
    border: none;
    padding: 10px 20px;
    margin-right: 10px;
    cursor: pointer;
    border-radius: 20px;
    font-weight: bold;
    transition: background-color 0.3s ease;
  }
  button:hover, .filter-buttons button:hover, #apply-filter:hover {
    background-color: #185abc;
  }
  footer {
    background-color: #1a73e8;
    color: white;
    text-align: center;
    padding: 20px 0;
    margin-top: 40px;
  }
  .table-responsive {
    overflow-x: auto;
    max-width: 100%;
    margin-bottom: 20px;
  }
  table {
    border-collapse: separate;
    border-spacing: 2px;
    min-width: 100%;
    width: auto;
    margin-bottom: 0;
    font-size: 14px;
    border: none;
  }
  th, td {
    border: 1px solid #e0e0e0;
    padding: 10px;
    text-align: left;
    border-radius: 8px;
    white-space: nowrap;
    min-width: 100px;
  }
  th {
    background-color: #1a73e8;
    font-weight: 500;
    text-transform: uppercase;
    color: white;
    position: sticky;
    top: 0;
    z-index: 10;
    text-align: center;
  }
  td:nth-child(4) {
    text-align: center;
  }
  tr:nth-child(even) td {
    background-color: #f8f9fa;
  }
  tr:hover td {
    background-color: #e8f0fe;
  }
  .modal-content {
    border-radius: 10px;
  }
  h1, h2, h3 {
    color: #1a73e8;
    margin: 0;
    text-align: center;
  }
  h1 { font-size: 2em; margin-bottom: 15px; }
  h2 { font-size: 1.6em; margin-bottom: 10px; }
  h3 { font-size: 1.3em; margin-bottom: 25px; }
  th, td {
    border: 1px solid #e0e0e0;
    padding: 10px;
    text-align: left;
    border-radius: 8px;
  }
  th {
    background-color: #1a73e8;
    font-weight: 500;
    text-transform: uppercase;
    color: white;
    position: sticky;
    top: 0;
    z-index: 10;
    text-align: center;
  }
  td:nth-child(4) {
    text-align: center;
  }
  tr:nth-child(even) {
    background-color: #f8f9fa;
  }
  tr:hover {
    background-color: #e8f0fe;
  }
  .update-info {
    font-style: italic;
    color: #5f6368;
    margin-bottom: 20px;
    font-size: 0.8em;
  }
  .search-container {
    margin-bottom: 20px;
    position: relative;
  }
  #search-input {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
  }
  #search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: white;
    border: 1px solid #ddd;
    border-top: none;
    border-radius: 0 0 4px 4px;
    max-height: 300px;
    overflow-y: auto;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    z-index: 1000;
    display: none;
  }
  .search-result-item {
    padding: 10px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
  }
  .search-result-item:hover {
    background-color: #f0f0f0;
  }
  .highlight {
    background-color: yellow;
    font-weight: bold;
  }
  .font-size-controls {
    margin-bottom: 15px;
  }
  .font-size-controls button {
    background-color: #1a73e8;
    color: white;
    border: none;
    padding: 5px 10px;
    margin-right: 5px;
    cursor: pointer;
    border-radius: 4px;
  }
  .font-size-controls button:hover {
    background-color: #185abc;
  }
  .de-baja-counter {
    display: inline-flex;
    align-items: center;
    margin-left: 15px;
  }
  .de-baja-counter .count {
    background-color: #ff4444;
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    margin-right: 8px;
  }
  .de-baja-counter .label {
    color: #333;
    font-weight: bold;
  }
  #report-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }
  .modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 600px;
  }
  #tool-image-container img {
    max-width: 100%;
    height: auto;
  }
  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  .close:hover,
  .close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
  }
  @media print {
    .no-print { display: none; }
    body { background-color: #fff; }
    .container { box-shadow: none; padding: 0; }
  }
  @media (max-width: 768px) {
    .container { padding: 10px; }
    table { font-size: 12px; }
    th, td { padding: 8px; }
    h1 { font-size: 1.8em; }
    h2 { font-size: 1.4em; }
    h3 { font-size: 1.2em; }
    .modal-content { width: 95%; }
  }
  @media (max-width: 480px) {
    table { font-size: 10px; }
    th, td { padding: 5px; }
    .font-size-controls button { padding: 3px 6px; font-size: 0.8em; }
    h1 { font-size: 1.6em; }
    h2 { font-size: 1.3em; }
    h3 { font-size: 1.1em; }
  }
  td a {
    color: inherit;
    text-decoration: none;
  }
  .filter-buttons {
    margin-bottom: 20px;
  }
  #filter-options {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 20px;
  }
  #filter-options label {
    display: block;
    margin-bottom: 10px;
  }
</style></head><body>
  <header>
    <div class="container">
      <h1>INVENTARIO GENERAL DE HERRAMIENTAS</h1>
      <div class="header-divider"></div>
      <h2>CONDOMINIO CUMBRES DE QUILPUÉ</h2>
    </div>
  </header>

  <div class="container">
    <p class="update-info">Última actualización: <span id="last-updated"></span></p>

    <div class="font-size-controls no-print">
      <button id="increase-font">A+</button>
      <button id="decrease-font">A-</button>
      <div id="de-baja-counter" class="de-baja-counter">
        <span class="count">0</span>
        <span class="label">Herramientas De Baja</span>
      </div>
    </div>

    <div class="search-container no-print">
      <input type="text" id="search-input" placeholder="Buscar por nombre de herramienta o categoría...">
      <div id="search-results"></div>
    </div>

    <div class="filter-buttons no-print">
      <button id="filter-category">Filtrar por Categoría</button>
      <button id="filter-location">Filtrar por Ubicación</button>
      <button id="filter-status">Filtrar por Estado Actual</button>
    </div>

    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>N°</th>
            <th>CATEGORÍA</th>
            <th>PRODUCTO</th>
            <th>CANTIDAD</th>
            <th>MARCA</th>
            <th>UBICACIÓN</th>
            <th>ESTADO ACTUAL</th>
          </tr>
        </thead>
        <tbody id="inventory-body">
          <!-- Contenido dinámico aquí -->
        </tbody>
      </table>
    </div>

    <div class="no-print">
      <p style="font-size: 0.8em; color: #5f6368;">Este inventario se actualiza automáticamente cuando se realizan cambios en el documento de Google Sheets vinculado.</p>
    </div>
  </div>

  <footer>
    <p>&copy; Condominio Cumbres de Quilpué. Todos los derechos reservados.</p>
    <p>Contacto: comitecumbresdequilpue@gmail.com </p>
  </footer>

  <div id="tool-details-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="tool-name"></h2>
      <p><strong>Descripción:</strong> <span id="tool-description"></span></p>
      <p><strong>Fecha de Adquisición:</strong> <span id="tool-acquisition-date"></span></p>
      <div id="tool-image-container"></div>
    </div>
  </div>

  <div id="filter-popup" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="filter-title"></h2>
      <div id="filter-options"></div>
      <button id="apply-filter">Aplicar Filtro</button>
    </div>
  </div>

  <script>
let inventoryData = [];
let currentFontSize = 14;

function updateInventory() {
  fetch('https://docs.google.com/spreadsheets/d/104GGPflFlJrQWhsH3ig7cPo72AubWlO0/edit?usp=drivesdk&ouid=114403781423643563131&rtpof=true&sd=true')
    .then(function(response) { return response.text(); })
    .then(function(data) {
      var parser = new DOMParser();
      var htmlDoc = parser.parseFromString(data, 'text/html');
      var rows = htmlDoc.querySelectorAll('.waffle tr');
      var inventoryBody = document.getElementById('inventory-body');
      inventoryBody.innerHTML = '';
      inventoryData = [];

      for (var i = 7; i < rows.length; i++) {
        var cells = rows[i].querySelectorAll('td');
        if (cells.length >= 10 && cells[0].textContent.trim() !== '') {
          var rowData = {
            id: cells[0].textContent.trim(),
            category: cells[1].textContent.trim(),
            product: cells[2].textContent.trim(),
            quantity: cells[3].textContent.trim(),
            brand: cells[4].textContent.trim(),
            description: cells[5].textContent.trim(),
            location: cells[6].textContent.trim(),
            status: cells[7].textContent.trim(),
            acquisitionDate: cells[8].textContent.trim(),
            imageUrl: cells[9].querySelector('img') ? cells[9].querySelector('img').src : ''
          };
          inventoryData.push(rowData);
          var row = createTableRow(rowData);
          inventoryBody.appendChild(row);
        }
      }

      document.getElementById('last-updated').textContent = new Date().toLocaleString();
      updateDeBajaCounter();
    })
    .catch(function(error) { console.error('Error al actualizar el inventario:', error); });
}

function createTableRow(data) {
  var row = document.createElement('tr');
  if (data.status.toUpperCase() === 'DE BAJA') {
    row.style.backgroundColor = '#ffcccc';
    row.style.color = '#cc0000';
  }
  ['id', 'category', 'product', 'quantity', 'brand', 'location', 'status'].forEach(function(key) {
    var cell = document.createElement('td');
    if (key === 'product') {
      var link = document.createElement('a');
      link.href = '#';
      link.textContent = data[key];
      link.innerHTML += ' <i class="fas fa-search" style="font-size: 0.8em;"></i>';
      link.addEventListener('click', function(e) {
        e.preventDefault();
        showToolDetails(data);
      });
      cell.appendChild(link);
    } else {
      cell.textContent = data[key];
    }
    row.appendChild(cell);
  });
  return row;
}

function showToolDetails(toolData) {
  document.getElementById('tool-name').textContent = toolData.product;
  document.getElementById('tool-description').textContent = toolData.description;
  document.getElementById('tool-acquisition-date').textContent = toolData.acquisitionDate;
  
  var imageContainer = document.getElementById('tool-image-container');
  imageContainer.innerHTML = '';
  if (toolData.imageUrl) {
    var img = document.createElement('img');
    img.src = toolData.imageUrl;
    img.alt = toolData.product;
    imageContainer.appendChild(img);
  } else {
    imageContainer.textContent = 'No hay imagen disponible';
  }

  document.getElementById('tool-details-modal').style.display = 'block';
}

function searchInventory() {
  var searchTerm = document.getElementById('search-input').value.toLowerCase();
  var searchResults = document.getElementById('search-results');
  searchResults.innerHTML = '';

  if (searchTerm.length < 2) {
    searchResults.style.display = 'none';
    return;
  }

  var results = inventoryData.filter(function(item) { 
    return (item.product.toLowerCase().includes(searchTerm) ||
            item.brand.toLowerCase().includes(searchTerm) ||
            item.category.toLowerCase().includes(searchTerm) ||
            findSimilarWords(item.product.toLowerCase(), searchTerm) ||
            findSimilarWords(item.category.toLowerCase(), searchTerm));
  });

  if (results.length > 0) {
    results.forEach(function(item) {
      var resultItem = document.createElement('div');
      resultItem.className = 'search-result-item';
      resultItem.innerHTML = '<strong>' + highlightText(item.product, searchTerm) + '</strong><br>' +
                             'Categoría: ' + highlightText(item.category, searchTerm) + '<br>' +
                             'Cantidad: ' + item.quantity + ', Marca: ' + highlightText(item.brand, searchTerm) + '<br>' +
                             'Ubicación: ' + item.location;
      resultItem.addEventListener('click', function() {
        document.getElementById('search-input').value = item.product;
        searchResults.style.display = 'none';
      });
      searchResults.appendChild(resultItem);
    });
    searchResults.style.display = 'block';
  } else {
    searchResults.innerHTML = '<div class="search-result-item">No se encontraron resultados.</div>';
    searchResults.style.display = 'block';
  }
}

function highlightText(text, searchTerm) {
  var regex = new RegExp('(' + searchTerm + ')', 'gi');
  return text.replace(regex, '<span class="highlight">$1</span>');
}

function findSimilarWords(text, searchTerm) {
  var words = text.split(/\s+/);
  return words.some(function(word) {
    return levenshteinDistance(word, searchTerm) <= 2;
  });
}

function levenshteinDistance(a, b) {
  if (a.length === 0) return b.length;
  if (b.length === 0) return a.length;

  var matrix = [];

  for (var i = 0; i <= b.length; i++) {
    matrix[i] = [i];
  }

  for (var j = 0; j <= a.length; j++) {
    matrix[0][j] = j;
  }

  for (var i = 1; i <= b.length; i++) {
    for (var j = 1; j <= a.length; j++) {
      if (b.charAt(i - 1) === a.charAt(j - 1)) {
        matrix[i][j] = matrix[i - 1][j - 1];
      } else {
        matrix[i][j] = Math.min(
          matrix[i - 1][j - 1] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j] + 1
        );
      }
    }
  }

  return matrix[b.length][a.length];
}

function changeFontSize(delta) {
  currentFontSize += delta;
  document.querySelector('table').style.fontSize = currentFontSize + 'px';
}

function showFilterPopup(filterType) {
  const popup = document.getElementById('filter-popup');
  const title = document.getElementById('filter-title');
  const options = document.getElementById('filter-options');
  
  title.textContent = filterType === 'category' ? 'Filtrar por Categoría' : 
                      filterType === 'location' ? 'Filtrar por Ubicación' : 
                      'Filtrar por Estado Actual';
  options.innerHTML = '';
  
  const uniqueValues = [...new Set(inventoryData.map(item => item[filterType]))];
  
  uniqueValues.forEach(value => {
    const label = document.createElement('label');
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.value = value;
    label.appendChild(checkbox);
    label.appendChild(document.createTextNode(value));
    options.appendChild(label);
  });
  
  popup.style.display = 'block';
}

function applyFilter() {
  const options = document.getElementById('filter-options');
  const checkedValues = Array.from(options.querySelectorAll('input:checked')).map(input => input.value);
  
  const filteredData = inventoryData.filter(item => 
    checkedValues.includes(item.category) || 
    checkedValues.includes(item.location) ||
    checkedValues.includes(item.status)
  );
  
  updateTable(filteredData);
  document.getElementById('filter-popup').style.display = 'none';
  updateDeBajaCounter();
}

function updateTable(data) {
  const inventoryBody = document.getElementById('inventory-body');
  inventoryBody.innerHTML = '';
  
  data.forEach(item => {
    const row = createTableRow(item);
    inventoryBody.appendChild(row);
  });
}

function updateDeBajaCounter() {
  const deBajaCount = inventoryData.filter(item => item.status.toUpperCase() === 'DE BAJA').length;
  const countElement = document.querySelector('.de-baja-counter .count');
  countElement.textContent = deBajaCount;
}

updateInventory();
setInterval(updateInventory, 300000);

document.getElementById('search-input').addEventListener('input', searchInventory);
document.addEventListener('click', function(event) {
  var searchResults = document.getElementById('search-results');
  var searchInput = document.getElementById('search-input');
  if (event.target !== searchResults && event.target !== searchInput) {
    searchResults.style.display = 'none';
  }
});

document.getElementById('increase-font').addEventListener('click', function() { changeFontSize(1); });
document.getElementById('decrease-font').addEventListener('click', function() { changeFontSize(-1); });
document.getElementById('filter-category').addEventListener('click', () => showFilterPopup('category'));
document.getElementById('filter-location').addEventListener('click', () => showFilterPopup('location'));
document.getElementById('filter-status').addEventListener('click', () => showFilterPopup('status'));
document.getElementById('apply-filter').addEventListener('click', applyFilter);

document.querySelectorAll('.modal .close').forEach(function(closeBtn) {
  closeBtn.addEventListener('click', function() {
    closeBtn.closest('.modal').style.display = 'none';
    if (closeBtn.closest('.modal').id === 'filter-popup') {
      updateTable(inventoryData); // Reset to show all items when closing without applying filter
    }
  });
});

window.addEventListener('click', function(event) {
  if (event.target.classList.contains('modal')) {
    event.target.style.display = 'none';
  }
});

function adjustInitialFontSize() {
  var width = window.innerWidth;
  if (width <= 480) {
    currentFontSize = 10;
  } else if (width <= 768) {
    currentFontSize = 12;
  } else {
    currentFontSize = 14;
  }
  document.querySelector('table').style.fontSize = currentFontSize + 'px';
}

window.addEventListener('load', adjustInitialFontSize);
window.addEventListener('resize', adjustInitialFontSize);
</script>

</body></html>
